!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";function o(){v("log",1,arguments)}function r(){v("warn",2,arguments)}function c(){v("error",3,arguments)}function a(e,t,n){d()&&window.performance.measure(e,t,n)}function i(e){d()&&window.performance.mark(e)}function u(e,t,n){if(d()){var o=n||t+" - end";i(o),a(e,t,o)}}function s(e,t){void 0===m[e]&&(m[e]=performance&&performance.now()),o("timing: ("+(performance.now()-m[e])+") "+t)}function d(){return l===f.log}Object.defineProperty(t,"__esModule",{value:!0}),t.log=o,t.warn=r,t.error=c,t.perfMark=i,t.perfMarkEnd=u,t.logSince=s,t.isDetailedLog=d;var f=t.LOG_LEVELS={log:1,warn:2,error:3},l=f.warn,p=void 0,v=function(e,t,n){l>t||console[e].apply(console,n)},h=function(){p=!!(f.log&&window.performance&&window.performance.measure)};h();var m=(t.setLogLevel=function(e){l=e,h()},{})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeConnection=t.FAILED_TO_OPEN_IDB=void 0,t.default=function(){if(d)return d;var e=!1,t=Object.create(null),n=null,r=c.default.open(a,s),f=function(){return n.transaction([i],arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readwrite").objectStore(i)};return t.get=function(t){return new Promise(function(n,r){if(e)return r(u);var c=f("readonly").get(t);c.onsuccess=function(e){e.target.result?n(e.target.result):((0,o.log)("resource with id "+t+" is not in the cache"),r(null))},c.onerror=function(e){r(e)}})},t.skip=function(){return Promise.reject()},t.exists=function(t){return new Promise(function(n,o){if(e)return o(u);var r=f("readonly").count(t);r.onsuccess=function(e){e.target.result>0?n({}):o()},r.onerror=function(e){o(e)}})},t.removeResource=function(t){return new Promise(function(n,r){if(e)return r(u);var c=f(),a=c.delete(t);a.onsuccess=function(){(0,o.log)("removed resource "+t),n()},a.onerror=function(e){(0,o.error)("failed to remove resource "+t+". error: "+e),r(e)}})},t.put=function(t,n){var r=n.content,c=n.contentType;return new Promise(function(n,a){if(e)return a(u);var i=f(),s=i.put({id:t,content:r,contentType:c});s.onsuccess=n,s.onerror=function(e){(0,o.error)("failed to save item with id "+t+" in cache due to error "+e),a()}})},t.pruneDb=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise(function(r,c){if(e)return c(u);var a=f(),i=a.openCursor();i.onsuccess=function(e){var c=e.target.result;c?(n.includes(c.key)||(t.removeResource(c.key),(0,o.log)("pruned "+c.key)),c.continue()):r()},i.onerror=function(e){(0,o.error)("failed to get all keys while pruning cache. error"),c(e)}})},d=new Promise(function(c,a){r.onsuccess=function(e){n=e.target.result,c(t)},r.onupgradeneeded=function(e){e.target.result.createObjectStore(i,{keyPath:"id"})},r.onerror=function(n){e=!0,(0,o.error)("failed to open indexedDB "+JSON.stringify(n)),c(t)}})};var o=n(0),r=n(7),c=function(e){return e&&e.__esModule?e:{default:e}}(r),a="RESOURCE_CACHE",i="RESOURCES",u=t.FAILED_TO_OPEN_IDB="FAILED_TO_OPEN_IDB",s=4,d=null;t.closeConnection=function(){d=null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=!(!window.navigator||-1>=window.navigator.userAgent.indexOf("Edge"));t.getDataUrl=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text/javascript",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o?URL.createObjectURL(new Blob([e],{type:t})):(e=e.replace(/#/g,"%23").replace(/(\r\n|\n|\r)/gm,"%0A").replace(/</g,"%3C").replace(/\s\s/g," "),"data:"+t+(n?";base64":"")+","+e)}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.resources,n=void 0===t?[]:t,o=e.document,r=void 0===o?window.document:o,c=e.forceLoadFromCache,a=void 0!==c&&c,i=e.onLoadDone,u=e.recacheAfterVersionChange,d=void 0!==u&&u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=l.syncCacheOnly,C=void 0!==g&&g,E=l.wasManifestModified,M=void 0!==E&&E,R=l.overrideDomContentLoaded,D=void 0!==R&&R,T=l.forceRecaching,j=void 0!==T&&T;(0,s.perfMark)(y),!0===d&&!0===M&&(j=!0);var k=!1;return new Promise(function(e,t){if(0===n.length)return e();(0,f.default)().then(function(o){(0,h.sortResources)(n);var c=void 0,u=[],d=0,f=!0,l=[];n.forEach(function(h){var g=h.url,E=h.type,R=void 0===E?"js":E,T=h.target,P=void 0===T?"head":T,A=h.attributes,x=void 0===A?{}:A,B=h.cacheOnly,U=void 0!==B&&B,S=h.isBinary,F=h.networkOnly,N=void 0!==F&&F;"body"===P&&(k=!0),(0,s.perfMark)("load start "+g);var I=x,H=p.default[R];if(void 0===H)return(0,s.error)("Unsupported tag "+R);S=void 0!==H.defaultToBinary&&H.defaultToBinary;var G=U||C||!H.canAddToDom?L:r,K=void 0;(0,v.loadResource)({indexedDBAccess:o,url:g,immediate:a,isBinary:S,cacheOnly:U||C,forceRecaching:j,networkOnly:N}).then(function(e){var t=e.resource;l.push({url:g,fromCache:!0}),K=G.createElement(H.tagName);var n=t.content;if("js"===R){var o="";I.onload&&(o="/*--- capp-cache onload handler---*/\n"+I.onload),n="//# sourceURL="+g+"\n"+n+"\n"+o}H.setElementContentFunc({tag:K,documentTarget:G,content:n,resourceManifestObj:h,wasManifestModified:M}),K.setAttribute("data-cappcache-src",g)}).catch(function(e){if(null!==e)return(0,s.error)("error trying to load resource "+e),Promise.reject();f=!1,l.push({url:g,fromCache:!1});var t=H.tagName;void 0!==H.tagNameWhenNotInline&&(t=H.tagNameWhenNotInline,H.attributes=H.attributesWhenNotInline),K=G.createElement(t),H.alwaysCallSetContent&&H.setElementContentFunc({tag:K,documentTarget:G,resourceManifestObj:h}),H.contentFetchKey&&K.setAttribute(H.contentFetchKey,g),K.async=!!I.async}).then(function(){if(Object.keys(H.attributes).forEach(function(e){K.setAttribute(e,H.attributes[e])}),Object.keys(I).forEach(function(e){"async"!==e&&K.setAttribute(e,I[e])}),_.push({url:g,domSelector:G===L?null:H.tagName+"["+w+'="'+g+'"]'}),!U){var e=h._index;if(u[e]={state:b,domTarget:G[P],tag:K,url:g},0===e||H.allowLoadingOutOfOrder||I.async||e>0&&void 0!==u[e-1]&&u[e-1].state===O)for(;void 0!==u[e]&&u[e].state===b;){var t=u[e],n=t.domTarget,o=t.tag,r=t.url;(0,s.perfMark)(r),n.appendChild(o),(0,s.log)("%c added ["+r+"] to the "+P,"color: blue"),(0,s.perfMarkEnd)("add to DOM "+r,r),u[e].state=O,e++}else(0,s.log)("skipping resource "+g+" since the previous resource was not loaded yet")}}).catch(function(e){c=e}).then(function(){++d===n.length&&(void 0!==c?((0,s.error)("Error while loading resources "+c),t(c)):((0,m.appendOnLoadScript)({document:r,callback:function(){e({resources:l,allFromCache:f})},overrideDomContentLoaded:D,onLoadDone:i,elementAddedToBody:k}),(0,s.perfMarkEnd)("RESOURCES LOAD",y)))})})})})}function c(){return _.map(function(e){return{url:e.url,domSelector:e.domSelector}})}function a(e){var t=e.url,n=e.isBase64Text,o=void 0!==n&&n,r=e.isBinary,c=void 0===r||r;return new Promise(function(e,n){if(c&&C[t])return e(C[t]);(0,f.default)().then(function(e){return(0,v.loadResource)({indexedDBAccess:e,url:t,immediate:!0,isBinary:c})}).then(function(e){var t=e.resource,n=t.content,r=t.contentType;return c?URL.createObjectURL(n):(0,g.getDataUrl)(o?btoa(n):n,r,o)}).then(function(n){c&&(C[t]=n),e(n)}).catch(function(e){(0,s.error)("failed to fetch resource "+e),n(null)})})}function i(e){C[e]&&(C[e]=null,URL.revokeObjectURL(e))}function u(){(0,f.default)().then(function(e){e.pruneDb((0,v.getCachedFiles)())})}Object.defineProperty(t,"__esModule",{value:!0}),t.load=r,t.getLoadedResources=c,t.getResourceUri=a,t.revokeResourceUriForUrl=i,t.pruneDB=u;var s=n(0),d=n(1),f=o(d),l=n(8),p=o(l),v=n(4),h=n(11),m=n(12),g=n(2),y="Resources load start",w="data-cappcache-src",b="waiting",O="loaded",L={createElement:function(){return{appendChild:Function.prototype,setAttribute:Function.prototype}},head:{appendChild:Function.prototype},body:{appendChild:Function.prototype},createTextNode:Function.prototype},_=[],C={}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCachedFiles=t.loadResource=t.fetchAndSaveInCache=void 0;var o=n(0),r=n(5),c=n(9),a=n(1),i={},u=t.fetchAndSaveInCache=function(e){var t=e.url,n=e.indexedDBAccess,a=e.isBinary;return new Promise(function(e,i){(0,o.log)("fetching resource "+t+" to cache "+(a?"as binary":"")),(0,c.fetchResource)(t,a?"blob":void 0).then(function(c){(0,o.log)("successfully fetched resource "+t+" to cache"),e(c),n.put((0,r.id)(t),c)}).catch(function(e){(0,o.error)("failed to fetch resource "+t+" from the web with error "+e.status+": "+e.statusText),i(e)})})};t.loadResource=function(e){var t=e.indexedDBAccess,n=e.url,c=e.immediate,s=void 0!==c&&c,d=e.isBinary,f=void 0!==d&&d,l=e.cacheOnly,p=void 0!==l&&l,v=e.forceRecaching,h=void 0!==v&&v,m=e.networkOnly,g=void 0!==m&&m;(0,o.perfMark)("loadResource "+n+" start");var y=(0,r.id)(n),w="get";h?w="skip":p&&(w="exists");var b=new Promise(function(e,r){if(g)return r(null);t[w](y).then(function(t){(0,o.log)("resource "+y+" was in cache"),e({resource:t,fromCache:!0}),(0,o.perfMarkEnd)("loadResource "+n+(p?" (cache only)":""),"loadResource "+n+" start")}).catch(function(n){if(n&&n!==a.FAILED_TO_OPEN_IDB)return(0,o.error)((h?"re-caching resource":"failed to fetch resource from cache")+" "+y+"."+(n?" error"+n:"")),r(n);(0,o.log)("resource "+y+" was not in cache"),s?u({url:y,indexedDBAccess:t,isBinary:f}).then(function(t){return e({resource:t,fromCache:!1})}).catch(function(e){return r(e)}):(window.setTimeout(function(){return u({url:y,indexedDBAccess:t,isBinary:f}).catch(function(e){})},1e3),r(null))})});return i[y]=!0,b},t.getCachedFiles=function(){return Object.keys(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+t.pathname+t.search};t.id=function(e){if(window.URL){return new URL(e,window.location.href).href}return o(e)}},function(e,t,n){"use strict";var o=n(0),r=n(3),c=n(13),a=n(14),i=function(e){return e&&e.__esModule?e:{default:e}}(a);!function(){window.location.search.indexOf("debug-cp")>0&&(0,o.setLogLevel)(o.LOG_LEVELS.log);var e=document.getElementsByTagName("html")[0].dataset,t="true"===e.ccOverrideDomcontentloaded;if(t){var n=function e(t){t.stopImmediatePropagation(),t.preventDefault(),t.stopPropagation(),document.removeEventListener("DOMContentLoaded",e,!0)};document.addEventListener("DOMContentLoaded",n,!0)}var a=e.ccManifest;void 0!==a?i.default.fetchManifest(a,{overrideDomContentLoaded:t}).then(function(e){var t=e.manifest;e.wasModified&&(0,r.load)(t,{syncCacheOnly:!0,wasManifestModified:!0}).then(function(){(0,c.trigger)("manifestUpdated")}).catch(function(e){return(0,o.error)("failed to load manifest to cache after change "+e)})}).catch(function(e){(0,o.error)("error while fetching manifest "+e)}):(0,o.error)('Unable to find attribute "data-cc-manifest" on the HTML tag, CappCache will not work'),window.cappCache={version:"0.1.33",loadResources:r.load,getResourceUri:r.getResourceUri,revokeResourceUriForUrl:r.revokeResourceUriForUrl,pruneDB:r.pruneDB,on:c.on,getLoadedResources:r.getLoadedResources,setLogLevel:o.setLogLevel,LOG_LEVELS:o.LOG_LEVELS}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.indexedDB||{open:function(){var e={};return setTimeout(function(){return e.onerror("No indexedDB on window. This is a known Edge/IE bug, see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/9968399 ")}),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2);t.default={js:{tagName:"script",contentFetchKey:"src",attributes:{type:"text/javascript"},setElementContentFunc:function(e){var t=e.tag,n=e.documentTarget,r=e.content;e.wasManifestModified?t.setAttribute("src",(0,o.getDataUrl)(r)):t.appendChild(n.createTextNode(r))},canAddToDom:!0},css:{tagName:"style",contentFetchKey:"href",attributes:{type:"text/css"},tagNameWhenNotInline:"link",attributesWhenNotInline:{rel:"stylesheet"},setElementContentFunc:function(e){e.tag.innerHTML=e.content},canAddToDom:!0},blob:{canAddToDom:!1,attributes:{}},link:{tagName:"link",contentFetchKey:"href",canAddToDom:!0,setElementContentFunc:function(e){var t=e.tag,n=e.content;t.href=URL.createObjectURL(n)},attributes:{},defaultToBinary:!0,allowLoadingOutOfOrder:!0},fontface:{tagName:"style",attributes:{type:"text/css"},allowLoadingOutOfOrder:!0,defaultToBinary:!0,setElementContentFunc:function(e){var t=e.tag,n=e.content,o=e.resourceManifestObj,r=o.fontAttributes,c=o.localFontFamily,a=void 0===c?null:c,i=o.url,u=o.format,s=o.fallbackUrls,d=void 0===s?null:s,f="";Object.keys(r).forEach(function(e){f+="\n  "+e+": "+r[e]+";"});var l="src: ";a&&(l=a.reduce(function(e,t){return e+"local('"+t+"'), "},l));var p=void 0;p=void 0!==n?URL.createObjectURL(n):i,l&&(l+="url("+p+") format('"+u+"')"),d&&(l=d.reduce(function(e,t){var n=t.url,o=t.format;return o=o||"woff2","\n  "+e+" url("+n+") format('"+o+"'), "},l+", "),l=l.substring(0,l.length-2)),t.innerHTML="@font-face {"+f+l+";\n}"},canAddToDom:!0,alwaysCallSetContent:!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchResource=void 0;var o=n(10);t.fetchResource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";return new Promise(function(n,r){var c=new XMLHttpRequest;c.open("GET",e,!0),c.responseType=t,c.addEventListener("load",function(){if(200===c.status){var e=c.response,t={content:e,contentType:c.getResponseHeader("content-type")||""};n((0,o.handleResponse)(t))}else r(c)},!1),c.send()})}},function(e,t,n){"use strict";function o(e){var t=e.content,n=e.contentType;return/image\/svg\+xml/.test(n)&&(t=t.replace(/#/g,"%23")),{content:t,contentType:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.handleResponse=o},function(e,t,n){"use strict";function o(e){e.forEach(function(e,t){return e._index=t}),e.sort(function(e,t){return"fontface"===e.type&&"fontface"!==t.type?-1:"fontface"===t.type&&"fontface"!==e.type?1:e.cacheOnly&&!t.cacheOnly?1:t.cacheOnly&&!e.cacheOnly?-1:e._index-t._index}),e.forEach(function(e,t){return e._index=t})}Object.defineProperty(t,"__esModule",{value:!0}),t.sortResources=o},function(e,t,n){"use strict";function o(e){var t=e.document,n=e.callback,o=e.overrideDomContentLoaded,u=e.onLoadDone,s=void 0===u?Function.prototype:u,d=e.elementAddedToBody,f="__cappcache-"+(""+Math.random()).slice(2,10),l=void 0===s?"undefined":r(s),p="";if("string"===l)p=s;else if("function"===l){var v=n;n=function(){s(),v()}}window.cappCache[f]=n;var h=f+"__perf";window.cappCache[h]=(0,c.isDetailedLog)()?function(){(0,c.perfMarkEnd)("RESOURCES LOAD",i),(0,c.log)("Done loading resources")}:Function.prototype;var m=(0,a.getDataUrl)('window.cappCache["'+f+'"](); \n\t\t      window.cappCache["'+h+'"](); \n\t\t      delete window.cappCache["'+f+'"]; \n\t\t      delete window.cappCache["'+h+'"]; \n\t\t      '+(o?"document.dispatchEvent(new Event('DOMContentLoaded', {bubbles: true}));":"")+"\n\t\t      "+p+';\n\t\t      document.querySelector("#'+f+'").remove();'),g=t.createElement("script");g.id=f,g.async=!1,g.src=m,t[d?"body":"head"].appendChild(g)}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.appendOnLoadScript=o;var c=n(0),a=n(2),i="Resources load start"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={};t.on=function(e,t){void 0===o[e]&&(o[e]=[]),o[e].push(t)},t.trigger=function(e){void 0!==o[e]&&o[e].forEach(function(e){return e()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(4),c=n(3),a=n(5),i=n(1),u=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default={fetchManifest:function(e,t){var n=t.overrideDomContentLoaded,i=void 0!==n&&n,s=(0,a.id)(e);return new Promise(function(e,t){(0,u.default)().then(function(n){(0,r.loadResource)({indexedDBAccess:n,url:s,immediate:!0}).then(function(t){var a=t.fromCache,u=t.resource,d=u.content,f=JSON.parse(d);(0,c.load)(f,{overrideDomContentLoaded:i});var l=!1;a?(0,r.fetchAndSaveInCache)({url:s,indexedDBAccess:n}).then(function(t){var n=JSON.parse(t.content);n.version!==f.version&&((0,o.log)('new app cache version has changed from "'+f.version+'" to "'+n.version+'"'),l=!0),e({manifest:n,wasModified:l})}):e({manifest:f,wasModified:l})}).catch(function(e){(0,o.error)("failed to fetch manifest "+e),t(e)})})})}}}]);
//# sourceMappingURL=capp-cache.js.map